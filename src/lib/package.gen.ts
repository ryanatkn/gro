import type {Gen} from './gen.ts';
import {load_package_json} from './package_json.ts';
import {create_src_json} from './src_json.ts';

// TODO rename? `Package_Json + Src_Json = package.ts` currently, idk

// TODO consider an api that uses magic imports like SvelteKit's `$app`, like `$repo/package.json`

/**
 * A convenience `gen` file that outputs `$lib/package.ts`,
 * which mirrors `package.json` but in TypeScript,
 * allowing apps to import typesafe data from their own `package.json`.
 */
export const gen: Gen = ({origin_path}) => {
	const package_json = load_package_json();
	const src_json = create_src_json(package_json, undefined);

	const is_this_fuz = package_json.name === '@ryanatkn/fuz'; // TODO more robust?

	return `
// generated by ${origin_path}

import type {Package_Json} from '${
		is_this_fuz ? './package_json.js' : '@ryanatkn/fuz/package_json.js'
	}';
import type {Src_Json} from '${is_this_fuz ? './src_json.js' : '@ryanatkn/fuz/src_json.js'}';

export const package_json = ${JSON.stringify(package_json)} satisfies Package_Json;

export const src_json = ${JSON.stringify(src_json)} satisfies Src_Json;

// generated by ${origin_path}
	`;
};
